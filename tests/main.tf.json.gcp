{
    "data": {
        "template_file": {
            "inventory-vpc-gcp-east1": {
                "template": "${file(\"${path.module}/templates/inventory.tpl\")}",
                "vars": {
                    "ip_addrs": "${join(\",\", module.re-vpc-gcp-east1.re-nodes.*.name)}",
                    "rack_ids": "${join(\",\", module.re-vpc-gcp-east1.re-nodes.*.zone)}"
                }
            },
            "aa_db": {
                "template": "${file(\"${path.module}/templates/create_aa_db.tpl\")}",
                "vars": {
                    "redis_user_name": "admin@admin.com",
                    "redis_pwd": "admin",
                    "redis_cluster_name": "unit-test-name-cluster2.ps-redislabs.com",
                    "FQDN1": "domain1.test.net",
                    "FQDN2": "domain2.test.net"
                }
            },
            "extra_vars-vpc-gcp-east1": {
                "template": "${file(\"${path.module}/templates/extra-vars.tpl\")}",
                "vars": {
                    "ansible_user": "redislabs",
                    "redis_cluster_name": "unit-test-name-cluster1.ps-redislabs.com",
                    "redis_user_name": "admin@admin.com",
                    "redis_pwd": "admin",
                    "redis_email_from": "admin@domain.tld",
                    "redis_smtp_host": "smtp.domain.tld"
                }
            },
            "inventory-vpc-gcp-us": {
                "template": "${file(\"${path.module}/templates/inventory.tpl\")}",
                "vars": {
                    "ip_addrs": "${join(\",\", module.re-vpc-gcp-us.re-nodes.*.name)}",
                    "rack_ids": "${join(\",\", module.re-vpc-gcp-us.re-nodes.*.zone)}"
                }
            },
            "extra_vars-vpc-gcp-us": {
                "template": "${file(\"${path.module}/templates/extra-vars.tpl\")}",
                "vars": {
                    "ansible_user": "redislabs",
                    "redis_cluster_name": "unit-test-name-cluster2.ps-redislabs.com",
                    "redis_user_name": "admin@admin.com",
                    "redis_pwd": "admin",
                    "redis_email_from": "admin@domain.tld",
                    "redis_smtp_host": "smtp.domain.tld"
                }
            }
        }
    },
    "provider": {
        "google": {
            "project": "redislabs-sa-training-services",
            "region": "us-east1",
            "credentials": "${file(\"${path.module}/terraform_account.json\")}",
            "alias": "vpc-gcp-east1"
        },
        "google-beta": {
            "project": "redislabs-sa-training-services",
            "region": "us-east1",
            "credentials": "${file(\"${path.module}/terraform_account.json\")}",
            "alias": "vpc-gcp-east1"
        },
        "google": {
            "project": "redislabs-sa-training-services",
            "region": "us-central1",
            "credentials": "${file(\"${path.module}/terraform_account.json\")}",
            "alias": "vpc-gcp-us"
        },
        "google-beta": {
            "project": "redislabs-sa-training-services",
            "region": "us-central1",
            "credentials": "${file(\"${path.module}/terraform_account.json\")}",
            "alias": "vpc-gcp-us"
        }
    },
    "output": {
        "gcp-re-ui-vpc-gcp-east1-ip-output": {
            "value": "${module.re-ui-vpc-gcp-east1.ui-ip.address}"
        },
        "gcp-re-ui-vpc-gcp-us-ip-output": {
            "value": "${module.re-ui-vpc-gcp-us.ui-ip.address}"
        },
        "gcp-bastion-vpc-gcp-east1-ip-output": {
            "value": "${module.bastion-vpc-gcp-east1.bastion-public-ip}"
        },
        "gcp-bastion-vpc-gcp-us-ip-output": {
            "value": "${module.bastion-vpc-gcp-us.bastion-public-ip}"
        },
        "vpc-gcp-east1-dns-name": {
            "value": "unit-test-name-cluster1.ps-redislabs.com"
        },
        "vpc-gcp-us-dns-name": {
            "value": "unit-test-name-cluster2.ps-redislabs.com"
        }
    },
    "module": {
        "network-vpc-gcp-east1": {
            "source": "./modules/gcp/network",
            "name": "unit-test-name-vpc-gcp-east1",
            "resource_tags": {},
            "gce_public_subnet_cidr": "10.1.0.0/24",
            "region": "us-east1",
            "providers": {
                "google": "google.vpc-gcp-east1"
            },
            "vpc_request_list": [
                "${module.network-vpc-gcp-us.vpc}"
            ],
            "vpc_accept_list": [],
            "cidr_list": [
                "10.3.0.0/24",
                "10.4.0.0/16"
            ],
            "gce_private_subnet_cidr": "10.2.0.0/16"
        },
        "re-ui-vpc-gcp-east1": {
            "source": "./modules/gcp/re-ui",
            "name": "unit-test-name-vpc-gcp-east1",
            "resource_tags": {},
            "instances": "${module.re-vpc-gcp-east1.re-nodes.*.name}",
            "providers": {
                "google": "google.vpc-gcp-east1"
            },
            "zones": "${module.re-vpc-gcp-east1.re-nodes.*.zone}"
        },
        "network-vpc-gcp-us": {
            "source": "./modules/gcp/network",
            "name": "unit-test-name-vpc-gcp-us",
            "resource_tags": {},
            "gce_public_subnet_cidr": "10.3.0.0/24",
            "region": "us-central1",
            "providers": {
                "google": "google.vpc-gcp-us"
            },
            "vpc_request_list": [],
            "vpc_accept_list": [
                "${module.network-vpc-gcp-east1.vpc}"
            ],
            "cidr_list": [
                "10.1.0.0/24",
                "10.2.0.0/16"
            ],
            "gce_private_subnet_cidr": "10.4.0.0/16"
        },
        "re-ui-vpc-gcp-us": {
            "source": "./modules/gcp/re-ui",
            "name": "unit-test-name-vpc-gcp-us",
            "resource_tags": {},
            "instances": "${module.re-vpc-gcp-us.re-nodes.*.name}",
            "providers": {
                "google": "google.vpc-gcp-us"
            },
            "zones": "${module.re-vpc-gcp-us.re-nodes.*.zone}"
        },
        "bastion-vpc-gcp-east1": {
            "source": "./modules/gcp/bastion",
            "name": "unit-test-name-vpc-gcp-east1",
            "resource_tags": {},
            "gce_public_subnet_cidr": "10.1.0.0/24",
            "gce_private_subnet_cidr": "10.2.0.0/16",
            "region": "us-east1",
            "subnet": "${module.network-vpc-gcp-east1.public-subnet-name}",
            "os": "rhel-7-v20210721",
            "boot_disk_size": 50,
            "bastion_machine_type": "n1-standard-1",
            "gce_ssh_user": "redislabs",
            "gce_ssh_pub_key_file": "~/.ssh/id_rsa.pub",
            "active_active_script": "${data.template_file.aa_db}",
            "providers": {
                "google": "google.vpc-gcp-east1"
            },
            "zone": "us-east1-b"
        },
        "bastion-vpc-gcp-us": {
            "source": "./modules/gcp/bastion",
            "name": "unit-test-name-vpc-gcp-us",
            "resource_tags": {},
            "gce_public_subnet_cidr": "10.3.0.0/24",
            "gce_private_subnet_cidr": "10.4.0.0/16",
            "region": "us-central1",
            "subnet": "${module.network-vpc-gcp-us.public-subnet-name}",
            "os": "rhel-7-v20210721",
            "boot_disk_size": 50,
            "bastion_machine_type": "n1-standard-1",
            "gce_ssh_user": "redislabs",
            "gce_ssh_pub_key_file": "~/.ssh/id_rsa.pub",
            "active_active_script": "${data.template_file.aa_db}",
            "providers": {
                "google": "google.vpc-gcp-us"
            },
            "zone": "us-central1-b"
        },
        "ns-vpc-gcp-east1": {
            "source": "./modules/gcp/ns",
            "providers": {
                "google-beta": "google-beta.vpc-gcp-east1"
            },
            "cluster_fqdn": "unit-test-name-cluster1.ps-redislabs.com",
            "parent_zone": "ps-redislabs",
            "resource_tags": {},
            "ip_addresses": "${module.re-vpc-gcp-east1.re-public-ips}"
        },
        "ns-vpc-gcp-us": {
            "source": "./modules/gcp/ns",
            "providers": {
                "google-beta": "google-beta.vpc-gcp-us"
            },
            "cluster_fqdn": "unit-test-name-cluster2.ps-redislabs.com",
            "parent_zone": "ps-redislabs",
            "resource_tags": {},
            "ip_addresses": "${module.re-vpc-gcp-us.re-public-ips}"
        },
        "re-vpc-gcp-east1": {
            "source": "./modules/gcp/re",
            "name": "unit-test-name-vpc-gcp-east1",
            "resource_tags": {},
            "kube_worker_machine_count": 3,
            "kube_worker_machine_type": "n1-standard-4",
            "boot_disk_size": 50,
            "kube_worker_machine_image": "rhel-8-v20210721",
            "subnet": "${module.network-vpc-gcp-east1.private-subnet-name}",
            "gce_ssh_user": "redislabs",
            "gce_ssh_pub_key_file": "~/.ssh/id_rsa.pub",
            "providers": {
                "google": "google.vpc-gcp-east1"
            },
            "zones": [
                "us-east1-b",
                "us-east1-c",
                "us-east1-d"
            ]
        },
        "re-provisioner-vpc-gcp-east1": {
            "source": "./modules/ansible/re",
            "ssh_user": "redislabs",
            "inventory": "${data.template_file.inventory-vpc-gcp-east1}",
            "extra_vars": "${data.template_file.extra_vars-vpc-gcp-east1}",
            "ssh_private_key_file": "~/.ssh/id_rsa",
            "host": "${module.bastion-vpc-gcp-east1.bastion-public-ip}",
            "redis_distro": "https://s3.amazonaws.com/redis-enterprise-software-downloads/6.2.6/redislabs-6.2.6-7-rhel8-x86_64.tar"
        },
        "re-vpc-gcp-us": {
            "source": "./modules/gcp/re",
            "name": "unit-test-name-vpc-gcp-us",
            "resource_tags": {},
            "kube_worker_machine_count": 3,
            "kube_worker_machine_type": "n1-standard-4",
            "boot_disk_size": 50,
            "kube_worker_machine_image": "rhel-8-v20210721",
            "subnet": "${module.network-vpc-gcp-us.private-subnet-name}",
            "gce_ssh_user": "redislabs",
            "gce_ssh_pub_key_file": "~/.ssh/id_rsa.pub",
            "providers": {
                "google": "google.vpc-gcp-us"
            },
            "zones": [
                "us-central1-a",
                "us-central1-b",
                "us-central1-c"
            ]
        },
        "re-provisioner-vpc-gcp-us": {
            "source": "./modules/ansible/re",
            "ssh_user": "redislabs",
            "inventory": "${data.template_file.inventory-vpc-gcp-us}",
            "extra_vars": "${data.template_file.extra_vars-vpc-gcp-us}",
            "ssh_private_key_file": "~/.ssh/id_rsa",
            "host": "${module.bastion-vpc-gcp-us.bastion-public-ip}",
            "redis_distro": "https://s3.amazonaws.com/redis-enterprise-software-downloads/6.2.6/redislabs-6.2.6-7-rhel8-x86_64.tar"
        },
        "docker-provisioner-vpc-gcp-us": {
            "depends_on": [
                "module.re-provisioner-vpc-gcp-us"
            ],
            "source": "./modules/docker/create",
            "ssh_user": "redislabs",
            "ssh_private_key_file": "~/.ssh/id_rsa",
            "host": "${module.bastion-vpc-gcp-us.bastion-public-ip}"
        },
        "docker-service-vault-server": {
            "source": "./modules/docker/services",
            "depends_on": [
                "module.docker-provisioner-vpc-gcp-us"
            ],
            "ssh_user": "redislabs",
            "contents": "vault",
            "start_script": "start.sh",
            "ssh_private_key_file": "~/.ssh/id_rsa",
            "host": "${module.bastion-vpc-gcp-us.bastion-public-ip}"
        }
    }
}